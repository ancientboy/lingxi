<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>我的 AI 团队 - 灵犀云</title>
  <link rel="stylesheet" href="assets/css/chat.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <a href="index.html" class="logo">★ 灵犀云</a>
      <div class="status" id="connectionStatus">连接中...</div>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="showSessionList()">会话</button>
      <div class="agent-switcher" onclick="toggleAgentDropdown()">
        <div class="agent-avatar-mini" id="currentAgentEmoji">◈</div>
        <span id="currentAgentName">灵犀</span>
        <span>▼</span>
        <div class="agent-dropdown" id="agentDropdown"></div>
      </div>
      <button class="nav-btn" onclick="clearChat()">清空</button>
      <div class="dropdown">
        <div class="user-info" onclick="toggleDropdown()">
          <div class="user-avatar">◈</div>
          <div class="user-name" id="navUserName">用户</div>
        </div>
        <div class="dropdown-content" id="userDropdown">
          <div class="dropdown-item" onclick="showMyTeam()">我的团队</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showFeishuConfig()">📱 飞书配置</div>
          <div class="dropdown-item" onclick="showWecomConfig()">💼 企业微信</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showPasswordChange()">🔒 修改密码</div>
          <div class="dropdown-item" onclick="showSettings()">⚙️ 设置</div>
          <div class="dropdown-item" onclick="showAbout()">ℹ️ 关于</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item danger" onclick="logout()">🚪 退出登录</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- 团队管理弹窗 -->
  <div class="modal-overlay" id="teamModal">
    <div class="modal team-modal">
      <div class="modal-header">
        <h3>👥 我的团队</h3>
        <button class="close-btn" onclick="closeTeamModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="team-list" id="myTeamList"></div>
        <div class="add-team-section">
          <h4>添加成员</h4>
          <div class="available-agents" id="availableAgents"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 会话列表弹窗 -->
  <div class="modal-overlay" id="sessionModal">
    <div class="modal">
      <div class="modal-header">
        <h3>💬 会话列表</h3>
        <button class="close-btn" onclick="closeSessionModal()">×</button>
      </div>
      <div class="modal-body">
        <div class="session-list" id="sessionList"></div>
      </div>
    </div>
  </div>

  <!-- 飞书配置弹窗 -->
  <div class="modal-overlay" id="feishuModal">
    <div class="modal">
      <div class="modal-header">
        <h3>📱 飞书配置</h3>
        <button class="close-btn" onclick="closeFeishuModal()">×</button>
      </div>
      <div class="modal-body">
        <div id="feishuStatus" style="margin-bottom:16px;"></div>
        <form id="feishuForm" onsubmit="saveFeishuConfig(event)">
          <div class="form-group">
            <label>App ID</label>
            <input type="text" id="feishuAppId" placeholder="cli_xxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>App Secret</label>
            <input type="password" id="feishuAppSecret" placeholder="应用密钥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">保存配置</button>
        </form>
        <div id="feishuWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">Webhook 地址（复制到飞书开放平台）</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="feishuWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyFeishuWebhook()">复制</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 企业微信配置弹窗 -->
  <div class="modal-overlay" id="wecomModal">
    <div class="modal">
      <div class="modal-header">
        <h3>💼 企业微信配置</h3>
        <button class="close-btn" onclick="closeWecomModal()">×</button>
      </div>
      <div class="modal-body">
        <div id="wecomStatus" style="margin-bottom:16px;"></div>
        <form id="wecomForm" onsubmit="saveWecomConfig(event)">
          <div class="form-group">
            <label>企业 ID (Corp ID)</label>
            <input type="text" id="wecomCorpId" placeholder="wwxxxxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent ID</label>
            <input type="text" id="wecomAgentId" placeholder="1000001" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent Secret</label>
            <input type="password" id="wecomAgentSecret" placeholder="应用密钥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">保存配置</button>
        </form>
        <div id="wecomWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">回调地址</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="wecomWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyWecomWebhook()">复制</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 修改密码弹窗 -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <div class="modal-header">
        <h3>🔒 修改密码</h3>
        <button class="close-btn" onclick="closePasswordModal()">×</button>
      </div>
      <div class="modal-body">
        <form id="passwordForm" onsubmit="changePassword(event)">
          <div class="form-group">
            <label>当前密码</label>
            <input type="password" id="currentPassword" placeholder="输入当前密码" required>
          </div>
          <div class="form-group">
            <label>新密码</label>
            <input type="password" id="newPassword" placeholder="至少6位" required minlength="6">
          </div>
          <div class="form-group">
            <label>确认新密码</label>
            <input type="password" id="confirmPassword" placeholder="再次输入新密码" required>
          </div>
          <button type="submit" class="submit-btn">修改密码</button>
        </form>
      </div>
    </div>
  </div>

  <div class="chat-container">
    <div class="messages" id="messages">
      <div class="welcome" id="welcome">
        <div class="welcome-emoji">◈</div>
        <div class="welcome-title">你好，我是灵犀</div>
        <div class="welcome-desc">你的 AI 团队队长，来自星际的智能助手</div>
        <div class="team-tags" id="teamTags"></div>
      </div>
    </div>

    <div class="input-area">
      <div class="quick-actions">
        <button class="quick-btn" onclick="quickSend('帮我写一个脚本')">写脚本</button>
        <button class="quick-btn" onclick="quickSend('分析一下这个数据')">分析数据</button>
        <button class="quick-btn" onclick="quickSend('帮我做个计划')">做计划</button>
        <button class="quick-btn" onclick="quickSend('给点创意建议')">创意建议</button>
      </div>
      <div class="input-wrapper">
        <textarea class="input-field" id="inputField" placeholder="输入消息..." rows="1"></textarea>
        <button class="send-btn" id="sendBtn" onclick="handleSendClick()">➤</button>
      </div>
    </div>
  </div>

  <script src="assets/js/chat.js"></script>
</body>
</html>
