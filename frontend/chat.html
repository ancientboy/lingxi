<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµçŠ€äº‘ - AI å›¢é˜Ÿ</title>
  <link rel="stylesheet" href="assets/css/chat.css">
  <link rel="stylesheet" href="assets/css/dark.css" id="darkTheme" disabled>
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <a href="index.html" class="logo">çµçŠ€äº‘</a>
      <div class="status" id="connectionStatus">è¿æ¥ä¸­...</div>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="showSessionList()">ä¼šè¯</button>
      <div class="agent-switcher" onclick="toggleAgentDropdown()">
        <div class="agent-avatar-mini" id="currentAgentEmoji">â—ˆ</div>
        <span id="currentAgentName">çµçŠ€</span>
        <span>â–¼</span>
        <div class="agent-dropdown" id="agentDropdown"></div>
      </div>
      <button class="nav-btn" onclick="clearChat()">æ¸…ç©º</button>
      <div class="dropdown">
        <div class="user-info" onclick="toggleDropdown()">
          <div class="user-avatar">â—ˆ</div>
          <div class="user-name" id="navUserName">ç”¨æˆ·</div>
        </div>
        <div class="dropdown-content" id="userDropdown">
          <div class="dropdown-item" onclick="showMyTeam()">æˆ‘çš„å›¢é˜Ÿ</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showFeishuConfig()">é£ä¹¦é…ç½®</div>
          <div class="dropdown-item" onclick="showWecomConfig()">ä¼ä¸šå¾®ä¿¡</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="toggleTheme()">
            <span id="themeToggleText">ğŸŒ™ æ·±è‰²æ¨¡å¼</span>
          </div>
          <div class="dropdown-item" onclick="showPasswordChange()">ä¿®æ”¹å¯†ç </div>
          <div class="dropdown-item" onclick="showAbout()">å…³äº</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item danger" onclick="logout()">é€€å‡ºç™»å½•</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- å›¢é˜Ÿç®¡ç†å¼¹çª— -->
  <div class="modal-overlay" id="teamModal">
    <div class="modal team-modal">
      <div class="modal-header">
        <h3>ğŸ‘¥ æˆ‘çš„å›¢é˜Ÿ</h3>
        <button class="close-btn" onclick="closeTeamModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="team-list" id="myTeamList"></div>
        <div class="add-team-section">
          <h4>æ·»åŠ æˆå‘˜</h4>
          <div class="available-agents" id="availableAgents"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¼šè¯åˆ—è¡¨å¼¹çª— -->
  <div class="modal-overlay" id="sessionModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ’¬ ä¼šè¯åˆ—è¡¨</h3>
        <button class="close-btn" onclick="closeSessionModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="session-list" id="sessionList"></div>
      </div>
    </div>
  </div>

  <!-- é£ä¹¦é…ç½®å¼¹çª— -->
  <div class="modal-overlay" id="feishuModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ“± é£ä¹¦é…ç½®</h3>
        <button class="close-btn" onclick="closeFeishuModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="feishuStatus" style="margin-bottom:16px;"></div>
        <form id="feishuForm" onsubmit="saveFeishuConfig(event)">
          <div class="form-group">
            <label>App ID</label>
            <input type="text" id="feishuAppId" placeholder="cli_xxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>App Secret</label>
            <input type="password" id="feishuAppSecret" placeholder="åº”ç”¨å¯†é’¥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">ä¿å­˜é…ç½®</button>
        </form>
        <div id="feishuWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">Webhook åœ°å€ï¼ˆå¤åˆ¶åˆ°é£ä¹¦å¼€æ”¾å¹³å°ï¼‰</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="feishuWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyFeishuWebhook()">å¤åˆ¶</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¼ä¸šå¾®ä¿¡é…ç½®å¼¹çª— -->
  <div class="modal-overlay" id="wecomModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ’¼ ä¼ä¸šå¾®ä¿¡é…ç½®</h3>
        <button class="close-btn" onclick="closeWecomModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="wecomStatus" style="margin-bottom:16px;"></div>
        <form id="wecomForm" onsubmit="saveWecomConfig(event)">
          <div class="form-group">
            <label>ä¼ä¸š ID (Corp ID)</label>
            <input type="text" id="wecomCorpId" placeholder="wwxxxxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent ID</label>
            <input type="text" id="wecomAgentId" placeholder="1000001" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent Secret</label>
            <input type="password" id="wecomAgentSecret" placeholder="åº”ç”¨å¯†é’¥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">ä¿å­˜é…ç½®</button>
        </form>
        <div id="wecomWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">å›è°ƒåœ°å€</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="wecomWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyWecomWebhook()">å¤åˆ¶</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ”’ ä¿®æ”¹å¯†ç </h3>
        <button class="close-btn" onclick="closePasswordModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="passwordForm" onsubmit="changePassword(event)">
          <div class="form-group">
            <label>å½“å‰å¯†ç </label>
            <input type="password" id="currentPassword" placeholder="è¾“å…¥å½“å‰å¯†ç " required>
          </div>
          <div class="form-group">
            <label>æ–°å¯†ç </label>
            <input type="password" id="newPassword" placeholder="è‡³å°‘6ä½" required minlength="6">
          </div>
          <div class="form-group">
            <label>ç¡®è®¤æ–°å¯†ç </label>
            <input type="password" id="confirmPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
          </div>
          <button type="submit" class="submit-btn">ä¿®æ”¹å¯†ç </button>
        </form>
      </div>
    </div>
  </div>

  <div class="chat-container">
    <div class="messages" id="messages">
      <div class="welcome" id="welcome">
        <div class="welcome-emoji">â—ˆ</div>
        <div class="welcome-title">ä½ å¥½ï¼Œæˆ‘æ˜¯çµçŠ€</div>
        <div class="welcome-desc">ä½ çš„ AI å›¢é˜Ÿé˜Ÿé•¿ï¼Œæ¥è‡ªæ˜Ÿé™…çš„æ™ºèƒ½åŠ©æ‰‹</div>
        <div class="team-tags" id="teamTags"></div>
      </div>
    </div>

    <div class="input-area">
      <div class="quick-actions">
        <button class="quick-btn" onclick="quickSend('å¸®æˆ‘å†™ä¸€ä¸ªè„šæœ¬')">å†™è„šæœ¬</button>
        <button class="quick-btn" onclick="quickSend('åˆ†æä¸€ä¸‹è¿™ä¸ªæ•°æ®')">åˆ†ææ•°æ®</button>
        <button class="quick-btn" onclick="quickSend('å¸®æˆ‘åšä¸ªè®¡åˆ’')">åšè®¡åˆ’</button>
        <button class="quick-btn" onclick="quickSend('ç»™ç‚¹åˆ›æ„å»ºè®®')">åˆ›æ„å»ºè®®</button>
      </div>
      <div class="input-wrapper">
        <textarea class="input-field" id="inputField" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
        <button class="send-btn" id="sendBtn" onclick="handleSendClick()">â¤</button>
      </div>
    </div>
  </div>

  <!-- ä¸»é¢˜åˆ‡æ¢ -->
  <script>
    const THEME_KEY = 'lingxi_theme';
    
    // åˆå§‹åŒ–ä¸»é¢˜
    function initTheme() {
      const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
      applyTheme(savedTheme);
    }
    
    // åº”ç”¨ä¸»é¢˜
    function applyTheme(theme) {
      const darkTheme = document.getElementById('darkTheme');
      const toggleText = document.getElementById('themeToggleText');
      
      if (theme === 'dark') {
        darkTheme.disabled = false;
        if (toggleText) toggleText.textContent = 'â˜€ï¸ æµ…è‰²æ¨¡å¼';
      } else {
        darkTheme.disabled = true;
        if (toggleText) toggleText.textContent = 'ğŸŒ™ æ·±è‰²æ¨¡å¼';
      }
      
      localStorage.setItem(THEME_KEY, theme);
    }
    
    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const currentTheme = localStorage.getItem(THEME_KEY) || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
      
      // å…³é—­ä¸‹æ‹‰èœå•
      document.getElementById('userDropdown').classList.remove('show');
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ä¸»é¢˜
    initTheme();
  </script>
  
  <script src="assets/js/chat.js"></script>
</body>
</html>
