<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµçŠ€äº‘ - AI å›¢é˜Ÿ</title>
  <link rel="stylesheet" href="assets/css/chat.css">
  <link rel="stylesheet" href="assets/css/dark.css" id="darkTheme" disabled>
</head>
<body>
  <nav class="navbar">
    <div class="nav-left">
      <a href="index.html" class="logo">Lume</a>
      <div class="status-dot" id="connectionStatus" title="å·²è¿æ¥"></div>
    </div>
    <div class="nav-right">
      <!-- ç­¾åˆ°æŒ‰é’® -->
      <div class="checkin-btn" id="checkinBtn" onclick="handleCheckin()" title="æ¯æ—¥ç­¾åˆ°">
        <span class="checkin-icon">ğŸ“…</span>
        <span class="checkin-text" id="checkinText">ç­¾åˆ°</span>
        <span class="checkin-points" id="checkinPoints"></span>
      </div>
      <div class="agent-switcher" onclick="toggleAgentDropdown()" title="åˆ‡æ¢ Agent">
        <div class="agent-avatar-mini" id="currentAgentEmoji">âš¡</div>
        <div class="agent-dropdown" id="agentDropdown"></div>
      </div>
      <div class="dropdown">
        <div class="user-avatar-circle" onclick="toggleDropdown()" title="èœå•">
          <span id="navUserInitial">U</span>
        </div>
        <div class="dropdown-content" id="userDropdown">
          <div class="dropdown-header">
            <span id="navUserName">ç”¨æˆ·</span>
          </div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showMyTeam()">æˆ‘çš„å›¢é˜Ÿ</div>
          <div class="dropdown-item" onclick="showSessionList()">å†å²ä¼šè¯</div>
          <div class="dropdown-item" onclick="clearChat()">æ¸…ç©ºå¯¹è¯</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="showFeishuConfig()">é£ä¹¦é…ç½®</div>
          <div class="dropdown-item" onclick="showWecomConfig()">ä¼ä¸šå¾®ä¿¡</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" onclick="toggleTheme()">
            <span id="themeToggleText">ğŸŒ™ æ·±è‰²æ¨¡å¼</span>
          </div>
          <div class="dropdown-item" onclick="showPasswordChange()">ä¿®æ”¹å¯†ç </div>
          <div class="dropdown-item" onclick="showAbout()">å…³äº</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item danger" onclick="logout()">é€€å‡ºç™»å½•</div>
        </div>
      </div>
    </div>
  </nav>

  <!-- å›¢é˜Ÿç®¡ç†å¼¹çª— -->
  <div class="modal-overlay" id="teamModal">
    <div class="modal team-modal">
      <div class="modal-header">
        <h3>ğŸ‘¥ æˆ‘çš„å›¢é˜Ÿ</h3>
        <button class="close-btn" onclick="closeTeamModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="team-list" id="myTeamList"></div>
        <div class="add-team-section">
          <h4>æ·»åŠ æˆå‘˜</h4>
          <div class="available-agents" id="availableAgents"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¼šè¯åˆ—è¡¨å¼¹çª— -->
  <div class="modal-overlay" id="sessionModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ’¬ ä¼šè¯åˆ—è¡¨</h3>
        <button class="close-btn" onclick="closeSessionModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div class="session-list" id="sessionList"></div>
      </div>
    </div>
  </div>

  <!-- é£ä¹¦é…ç½®å¼¹çª— -->
  <div class="modal-overlay" id="feishuModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ“± é£ä¹¦é…ç½®</h3>
        <button class="close-btn" onclick="closeFeishuModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="feishuStatus" style="margin-bottom:16px;"></div>
        <form id="feishuForm" onsubmit="saveFeishuConfig(event)">
          <div class="form-group">
            <label>App ID</label>
            <input type="text" id="feishuAppId" placeholder="cli_xxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>App Secret</label>
            <input type="password" id="feishuAppSecret" placeholder="åº”ç”¨å¯†é’¥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">ä¿å­˜é…ç½®</button>
        </form>
        <div id="feishuWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">Webhook åœ°å€ï¼ˆå¤åˆ¶åˆ°é£ä¹¦å¼€æ”¾å¹³å°ï¼‰</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="feishuWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyFeishuWebhook()">å¤åˆ¶</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¼ä¸šå¾®ä¿¡é…ç½®å¼¹çª— -->
  <div class="modal-overlay" id="wecomModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ’¼ ä¼ä¸šå¾®ä¿¡é…ç½®</h3>
        <button class="close-btn" onclick="closeWecomModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="wecomStatus" style="margin-bottom:16px;"></div>
        <form id="wecomForm" onsubmit="saveWecomConfig(event)">
          <div class="form-group">
            <label>ä¼ä¸š ID (Corp ID)</label>
            <input type="text" id="wecomCorpId" placeholder="wwxxxxxxxxxxxxxx" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent ID</label>
            <input type="text" id="wecomAgentId" placeholder="1000001" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Agent Secret</label>
            <input type="password" id="wecomAgentSecret" placeholder="åº”ç”¨å¯†é’¥" autocomplete="off">
          </div>
          <button type="submit" class="submit-btn">ä¿å­˜é…ç½®</button>
        </form>
        <div id="wecomWebhook" style="margin-top:16px;display:none;">
          <label style="font-size:12px;color:rgba(255,255,255,0.6);">å›è°ƒåœ°å€</label>
          <div style="display:flex;gap:8px;margin-top:6px;">
            <input type="text" id="wecomWebhookUrl" readonly style="flex:1;font-size:12px;">
            <button type="button" class="nav-btn" onclick="copyWecomWebhook()">å¤åˆ¶</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¿®æ”¹å¯†ç å¼¹çª— -->
  <div class="modal-overlay" id="passwordModal">
    <div class="modal">
      <div class="modal-header">
        <h3>ğŸ”’ ä¿®æ”¹å¯†ç </h3>
        <button class="close-btn" onclick="closePasswordModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="passwordForm" onsubmit="changePassword(event)">
          <div class="form-group">
            <label>å½“å‰å¯†ç </label>
            <input type="password" id="currentPassword" placeholder="è¾“å…¥å½“å‰å¯†ç " required>
          </div>
          <div class="form-group">
            <label>æ–°å¯†ç </label>
            <input type="password" id="newPassword" placeholder="è‡³å°‘6ä½" required minlength="6">
          </div>
          <div class="form-group">
            <label>ç¡®è®¤æ–°å¯†ç </label>
            <input type="password" id="confirmPassword" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
          </div>
          <button type="submit" class="submit-btn">ä¿®æ”¹å¯†ç </button>
        </form>
      </div>
    </div>
  </div>

  <!-- æ–°ç”¨æˆ·å¼•å¯¼å¼¹çª— -->
  <div class="modal-overlay" id="onboardingModal" style="display:none;">
    <div class="modal onboarding-modal" style="max-width:480px;">
      <!-- Step 1: æ¬¢è¿ -->
      <div id="onboardingStep1" class="onboarding-step">
        <div class="onboarding-welcome">
          <div class="onboarding-emoji">âš¡</div>
          <h2>ä½ å¥½ï¼æˆ‘æ˜¯çµçŠ€</h2>
          <p>ä½ çš„ AI å›¢é˜Ÿé˜Ÿé•¿ï¼Œæ¥è‡ªæ˜Ÿé™…çš„æ™ºèƒ½åŠ©æ‰‹</p>
          <p style="font-size:14px;color:rgba(255,255,255,0.6);margin-top:16px;">
            çœ‹èµ·æ¥ä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥ï¼Œè®©æˆ‘å…ˆäº†è§£ä¸€ä¸‹ä½ ï½
          </p>
        </div>
        <button class="home-btn" onclick="goToOnboardingStep(2)" style="margin-top:24px;">
          å¼€å§‹äº†è§£
        </button>
      </div>
      
      <!-- Step 2: é€‰æ‹©èŒä¸š -->
      <div id="onboardingStep2" class="onboarding-step" style="display:none;">
        <h3 style="text-align:center;margin-bottom:20px;">è¯·é—®ä½ ä¸»è¦æ˜¯åšä»€ä¹ˆå·¥ä½œçš„ï¼Ÿ</h3>
        <div class="job-type-grid" id="jobTypeGrid"></div>
      </div>
      
      <!-- Step 3: æ¨èé…ç½® -->
      <div id="onboardingStep3" class="onboarding-step" style="display:none;">
        <h3 style="text-align:center;margin-bottom:8px;">æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘å»ºè®®é…ç½®</h3>
        <p id="recommendationHint" style="text-align:center;font-size:13px;color:rgba(255,255,255,0.5);margin-bottom:20px;"></p>
        
        <div class="recommendation-agents" id="recommendationAgents"></div>
        
        <div style="margin-top:24px;display:flex;gap:12px;">
          <button class="home-btn home-btn-secondary" onclick="goToOnboardingStep(2)" style="flex:1;">
            é‡æ–°é€‰æ‹©
          </button>
          <button class="home-btn" onclick="applyRecommendation()" id="applyRecommendationBtn" style="flex:1;">
            åº”ç”¨é…ç½®
          </button>
        </div>
      </div>
      
      <!-- Step 4: å®Œæˆ -->
      <div id="onboardingStep4" class="onboarding-step" style="display:none;">
        <div class="onboarding-complete">
          <div class="onboarding-emoji" style="background:#10a37f;">âœ“</div>
          <h2>ğŸ‰ é…ç½®å®Œæˆï¼</h2>
          <p>ä½ çš„ AI å›¢é˜Ÿå·²å°±ç»ªï¼Œç°åœ¨å¯ä»¥å¼€å§‹å¯¹è¯äº†</p>
          <div class="team-preview" id="teamPreview"></div>
        </div>
        <button class="home-btn" onclick="startChat()" style="margin-top:24px;">
          å¼€å§‹å¯¹è¯
        </button>
      </div>
    </div>
  </div>

  <style>
    /* å¼•å¯¼å¼¹çª—æ ·å¼ */
    .onboarding-modal {
      background: linear-gradient(145deg, #1a1a2e 0%, #16213e 100%);
    }
    
    .onboarding-step {
      padding: 20px;
    }
    
    .onboarding-welcome {
      text-align: center;
      padding: 20px 0;
    }
    
    .onboarding-emoji {
      width: 80px;
      height: 80px;
      background: #10a37f;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 40px;
    }
    
    .onboarding-welcome h2 {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .job-type-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .job-type-item {
      padding: 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }
    
    .job-type-item:hover {
      background: rgba(255,255,255,0.1);
      border-color: #10a37f;
    }
    
    .job-type-item.selected {
      background: rgba(16,163,127,0.2);
      border-color: #10a37f;
    }
    
    .recommendation-agents {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .recommendation-agent {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
    }
    
    .recommendation-agent .emoji {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .recommendation-agent .info {
      flex: 1;
    }
    
    .recommendation-agent .name {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .recommendation-agent .desc {
      font-size: 13px;
      color: rgba(255,255,255,0.6);
    }
    
    .onboarding-complete {
      text-align: center;
      padding: 20px 0;
    }
    
    .team-preview {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .team-preview-avatar {
      width: 48px;
      height: 48px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    /* ç­¾åˆ°æŒ‰é’® */
    .checkin-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      border-radius: 20px;
      color: white;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      margin-right: 8px;
    }
    
    .checkin-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
    }
    
    .checkin-btn.checked-in {
      background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
      cursor: default;
    }
    
    .checkin-btn.checked-in:hover {
      transform: none;
      box-shadow: none;
    }
    
    .checkin-icon {
      font-size: 16px;
    }
    
    .checkin-points {
      font-size: 11px;
      opacity: 0.9;
    }
    
  </style>

  <div class="chat-container">
    <div class="messages" id="messages">
      <div class="welcome" id="welcome">
        <div class="welcome-emoji">âœ¨</div>
        <div class="welcome-title">ä½ å¥½ï¼Œæˆ‘æ˜¯ Lume</div>
        <div class="welcome-desc">ä½ çš„ AI å›¢é˜Ÿé˜Ÿé•¿ï¼Œæ¥è‡ªæ˜Ÿé™…çš„æ™ºèƒ½åŠ©æ‰‹</div>
        <div class="team-tags" id="teamTags"></div>
      </div>
    </div>

    <div class="input-area">
      <div class="input-wrapper">
        <textarea class="input-field" id="inputField" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
        <button class="send-btn" id="sendBtn" onclick="handleSendClick()">â¤</button>
      </div>
    </div>
  </div>

  <!-- ä¸»é¢˜åˆ‡æ¢ -->
  <script>
    const THEME_KEY = 'lingxi_theme';
    
    // åˆå§‹åŒ–ä¸»é¢˜
    function initTheme() {
      const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
      applyTheme(savedTheme);
    }
    
    // åº”ç”¨ä¸»é¢˜
    function applyTheme(theme) {
      const darkTheme = document.getElementById('darkTheme');
      const toggleText = document.getElementById('themeToggleText');
      
      if (theme === 'dark') {
        darkTheme.disabled = false;
        if (toggleText) toggleText.textContent = 'â˜€ï¸ æµ…è‰²æ¨¡å¼';
      } else {
        darkTheme.disabled = true;
        if (toggleText) toggleText.textContent = 'ğŸŒ™ æ·±è‰²æ¨¡å¼';
      }
      
      localStorage.setItem(THEME_KEY, theme);
    }
    
    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const currentTheme = localStorage.getItem(THEME_KEY) || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
      
      // å…³é—­ä¸‹æ‹‰èœå•
      document.getElementById('userDropdown').classList.remove('show');
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ä¸»é¢˜
    initTheme();
    checkCheckinStatus();
  </script>
  
  <script src="assets/js/chat.js"></script>
</body>
</html>
