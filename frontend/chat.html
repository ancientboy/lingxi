<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµçŠ€äº‘ - æˆ‘çš„ AI å›¢é˜Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0f;
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #fff;
      overflow: hidden;
    }

    /* é¡¶éƒ¨å¯¼èˆª */
    .navbar {
      background: rgba(20, 20, 30, 0.95);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
    }

    .user-name {
      color: #00d4ff;
      font-weight: 500;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .nav-btn {
      padding: 8px 16px;
      font-size: 13px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: transparent;
      color: rgba(255, 255, 255, 0.8);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .nav-btn.primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      color: #fff;
    }

    /* ä¸»å†…å®¹åŒº */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ä¾§è¾¹æ  */
    .sidebar {
      width: 240px;
      background: rgba(15, 15, 25, 0.95);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .sidebar-header {
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 13px;
      color: rgba(255, 255, 255, 0.5);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .team-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
    }

    .team-member {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 5px;
    }

    .team-member:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .team-member.active {
      background: rgba(102, 126, 234, 0.2);
      border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .member-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .member-info {
      flex: 1;
    }

    .member-name {
      font-size: 14px;
      font-weight: 500;
    }

    .member-role {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
    }

    /* èŠå¤©åŒºåŸŸ */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #0a0a0f;
    }

    .chat-iframe {
      flex: 1;
      border: none;
      width: 100%;
      height: 100%;
    }

    /* é›†æˆæç¤º */
    .integration-bar {
      background: rgba(16, 185, 129, 0.1);
      border-top: 1px solid rgba(16, 185, 129, 0.2);
      padding: 10px 20px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.6);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .integration-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
    }

    .status-dot.inactive {
      background: rgba(255, 255, 255, 0.3);
    }

    .setup-link {
      color: #00d4ff;
      text-decoration: none;
      font-size: 12px;
    }

    .setup-link:hover {
      text-decoration: underline;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      
      .nav-right .nav-btn:not(.primary) {
        display: none;
      }
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 20px;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <nav class="navbar">
    <div class="nav-left">
      <div class="logo">âš¡ çµçŠ€äº‘</div>
      <div class="user-info">
        <span>æ¬¢è¿ï¼Œ</span>
        <span class="user-name" id="userName">ç”¨æˆ·</span>
      </div>
    </div>
    <div class="nav-right">
      <a href="/" class="nav-btn">è¿”å›é¦–é¡µ</a>
      <a href="https://github.com/ancientboy/lingxi" target="_blank" class="nav-btn">GitHub</a>
      <button class="nav-btn primary" onclick="showSettings()">âš™ï¸ è®¾ç½®</button>
    </div>
  </nav>

  <!-- ä¸»å†…å®¹ -->
  <div class="main-content">
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
      <div class="sidebar-header">æˆ‘çš„å›¢é˜Ÿ</div>
      <div class="team-list" id="teamList">
        <!-- åŠ¨æ€åŠ è½½ -->
      </div>
    </aside>

    <!-- èŠå¤©åŒºåŸŸ -->
    <div class="chat-container">
      <iframe id="chatFrame" class="chat-iframe" src="about:blank"></iframe>
      
      <!-- é›†æˆçŠ¶æ€æ  -->
      <div class="integration-bar">
        <div class="integration-status">
          <span class="status-dot" id="feishuStatus"></span>
          <span>é£ä¹¦</span>
          <span class="status-dot inactive" id="wecomStatus"></span>
          <span>ä¼ä¸šå¾®ä¿¡</span>
        </div>
        <a href="/" class="setup-link">é…ç½®æ¥å…¥ â†’</a>
      </div>
    </div>
  </div>

  <script>
    // é…ç½®
    const API_BASE = 'http://localhost:3000';
    
    // Agent ä¿¡æ¯
    const AGENT_INFO = {
      lingxi: { emoji: 'âš¡', name: 'çµçŠ€', role: 'é˜Ÿé•¿ Â· æ™ºèƒ½è°ƒåº¦' },
      coder: { emoji: 'ğŸ’»', name: 'äº‘æºª', role: 'ä»£ç å¥³ç‹' },
      ops: { emoji: 'ğŸ“Š', name: 'è‹¥æ›¦', role: 'è¿è¥ä¸“å®¶' },
      inventor: { emoji: 'ğŸ’¡', name: 'ç´«è±', role: 'åˆ›æ„å¤©æ‰' },
      pm: { emoji: 'ğŸ¯', name: 'æ¢“è±', role: 'äº§å“å¥³ç‹' },
      noter: { emoji: 'ğŸ“', name: 'æ™“ç³', role: 'çŸ¥è¯†ç®¡ç†' },
      media: { emoji: 'ğŸ§', name: 'éŸ³éŸµ', role: 'å¤šåª’ä½“' },
      smart: { emoji: 'ğŸ ', name: 'æ™ºå®¶', role: 'æ™ºèƒ½å®¶å±…' }
    };

    // è·å– URL å‚æ•°
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('userId');
    const token = urlParams.get('token');
    const nickname = urlParams.get('nickname') || 'ç”¨æˆ·';
    const agentsParam = urlParams.get('agents');

    // è§£æç”¨æˆ·å›¢é˜Ÿ
    let userAgents = ['lingxi'];
    if (agentsParam) {
      try {
        userAgents = JSON.parse(decodeURIComponent(agentsParam));
      } catch (e) {
        userAgents = agentsParam.split(',');
      }
    }

    // OpenClaw URL
    const OPENCLAW_URL = 'http://120.26.137.51:18789/c308f1f0?token=6f3719a52fa12799fea8e4a06655703f';

    // åˆå§‹åŒ–
    function init() {
      // æ˜¾ç¤ºç”¨æˆ·å
      document.getElementById('userName').textContent = nickname;
      
      // æ¸²æŸ“å›¢é˜Ÿåˆ—è¡¨
      renderTeamList();
      
      // åŠ è½½èŠå¤©ç•Œé¢
      document.getElementById('chatFrame').src = OPENCLAW_URL;
      
      // æ£€æŸ¥é›†æˆçŠ¶æ€
      checkIntegrationStatus();
    }

    // æ¸²æŸ“å›¢é˜Ÿåˆ—è¡¨
    function renderTeamList() {
      const teamList = document.getElementById('teamList');
      
      teamList.innerHTML = userAgents.map((agentId, index) => {
        const agent = AGENT_INFO[agentId] || { emoji: 'ğŸ¤–', name: agentId, role: 'åŠ©æ‰‹' };
        return `
          <div class="team-member ${index === 0 ? 'active' : ''}" onclick="selectAgent('${agentId}')">
            <div class="member-avatar">${agent.emoji}</div>
            <div class="member-info">
              <div class="member-name">${agent.name}</div>
              <div class="member-role">${agent.role}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    // é€‰æ‹© Agent
    function selectAgent(agentId) {
      document.querySelectorAll('.team-member').forEach(el => {
        el.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      // å¯ä»¥åœ¨è¿™é‡Œå®ç°åˆ‡æ¢åˆ°ç‰¹å®š Agent çš„é€»è¾‘
      console.log('é€‰ä¸­ Agent:', agentId);
    }

    // æ£€æŸ¥é›†æˆçŠ¶æ€
    async function checkIntegrationStatus() {
      if (!userId) return;
      
      try {
        // æ£€æŸ¥é£ä¹¦çŠ¶æ€
        const feishuRes = await fetch(`${API_BASE}/api/feishu/status/${userId}`);
        const feishuData = await feishuRes.json();
        document.getElementById('feishuStatus').classList.toggle('inactive', !feishuData.configured);
        
        // æ£€æŸ¥ä¼ä¸šå¾®ä¿¡çŠ¶æ€
        const wecomRes = await fetch(`${API_BASE}/api/wecom/status/${userId}`);
        const wecomData = await wecomRes.json();
        document.getElementById('wecomStatus').classList.toggle('inactive', !wecomData.configured);
      } catch (e) {
        console.log('æ£€æŸ¥é›†æˆçŠ¶æ€å¤±è´¥:', e);
      }
    }

    // æ˜¾ç¤ºè®¾ç½®
    function showSettings() {
      alert('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...\n\nå½“å‰å¯è¿”å›é¦–é¡µé…ç½®é£ä¹¦/ä¼ä¸šå¾®ä¿¡æ¥å…¥');
    }

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
