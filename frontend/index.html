<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çµçŠ€äº‘ - ä¸€é”®æ‹¥æœ‰ä½ çš„ AI å›¢é˜Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: white;
      border-radius: 20px;
      padding: 60px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .logo {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #666;
      font-size: 16px;
      margin-bottom: 40px;
    }
    
    .features {
      text-align: left;
      margin-bottom: 40px;
    }
    
    .feature {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }
    
    .feature:last-child {
      border-bottom: none;
    }
    
    .feature-icon {
      font-size: 24px;
      margin-right: 15px;
    }
    
    .feature-text {
      color: #444;
    }
    
    .deploy-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 18px 50px;
      font-size: 18px;
      border-radius: 50px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .deploy-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    
    .deploy-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .status {
      margin-top: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      display: none;
    }
    
    .status.active {
      display: block;
    }
    
    .status-text {
      color: #666;
      margin-bottom: 10px;
    }
    
    .progress-bar {
      height: 6px;
      background: #e0e0e0;
      border-radius: 3px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }
    
    .success {
      display: none;
    }
    
    .success.active {
      display: block;
    }
    
    .success-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    .success h2 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .success p {
      color: #666;
      margin-bottom: 30px;
    }
    
    .chat-btn {
      background: #10b981;
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 16px;
      border-radius: 50px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
    }
    
    .chat-btn:hover {
      background: #059669;
    }
    
    .error {
      color: #ef4444;
      margin-top: 20px;
      display: none;
    }
    
    .error.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- è½åœ°é¡µ -->
    <div id="landing">
      <div class="logo">âš¡</div>
      <h1>çµçŠ€äº‘</h1>
      <p class="subtitle">ä¸€é”®æ‹¥æœ‰ä½ çš„ AI å›¢é˜Ÿ</p>
      
      <div class="features">
        <div class="feature">
          <span class="feature-icon">ğŸš€</span>
          <span class="feature-text">30 ç§’éƒ¨ç½²ï¼Œå¼€ç®±å³ç”¨</span>
        </div>
        <div class="feature">
          <span class="feature-icon">ğŸ‘¥</span>
          <span class="feature-text">8 ä½ä¸“ä¸š AI åŠ©æ‰‹æŒ‰éœ€é…ç½®</span>
        </div>
        <div class="feature">
          <span class="feature-icon">ğŸ§ </span>
          <span class="feature-text">çµçŠ€é˜Ÿé•¿æ™ºèƒ½è°ƒåº¦</span>
        </div>
        <div class="feature">
          <span class="feature-icon">ğŸ’¡</span>
          <span class="feature-text">æ ¹æ®ä½ çš„éœ€æ±‚è‡ªåŠ¨æ¨è</span>
        </div>
      </div>
      
      <button class="deploy-btn" onclick="startDeploy()">
        ä¸€é”®éƒ¨ç½²
      </button>
      
      <div id="error" class="error"></div>
    </div>
    
    <!-- éƒ¨ç½²ä¸­ -->
    <div id="status" class="status">
      <p class="status-text" id="statusText">æ­£åœ¨ä¸ºä½ å‡†å¤‡ AI å›¢é˜Ÿ...</p>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>
    
    <!-- éƒ¨ç½²æˆåŠŸ -->
    <div id="success" class="success">
      <div class="success-icon">âœ¨</div>
      <h2>ä½ çš„çµçŠ€å·²å°±ç»ªï¼</h2>
      <p>çµçŠ€æ­£åœ¨ç­‰ä½ ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹å¯¹è¯</p>
      <a href="#" class="chat-btn" id="chatBtn">å¼€å§‹å¯¹è¯</a>
    </div>
  </div>
  
  <script>
    const API_BASE = window.location.origin + ':3000';
    let progress = 0;
    
    async function startDeploy() {
      const btn = document.querySelector('.deploy-btn');
      const landing = document.getElementById('landing');
      const status = document.getElementById('status');
      const success = document.getElementById('success');
      const error = document.getElementById('error');
      
      // éšè—é”™è¯¯
      error.classList.remove('active');
      
      // ç¦ç”¨æŒ‰é’®
      btn.disabled = true;
      btn.textContent = 'éƒ¨ç½²ä¸­...';
      
      // æ˜¾ç¤ºçŠ¶æ€
      status.classList.add('active');
      
      // ç”Ÿæˆç”¨æˆ· ID
      const userId = 'user-' + Date.now();
      
      // æ¨¡æ‹Ÿè¿›åº¦
      const progressInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 90) progress = 90;
        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('statusText').textContent = getStatusText(progress);
      }, 500);
      
      try {
        // è°ƒç”¨åˆ†é…å®ä¾‹æ¥å£
        const response = await fetch(API_BASE + '/api/instance/assign', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'éƒ¨ç½²å¤±è´¥');
        }
        
        // å®Œæˆ
        clearInterval(progressInterval);
        document.getElementById('progressFill').style.width = '100%';
        
        setTimeout(() => {
          status.classList.remove('active');
          success.classList.add('active');
          
          // è®¾ç½®èŠå¤©é“¾æ¥
          document.getElementById('chatBtn').href = data.instance.url;
        }, 500);
        
      } catch (err) {
        clearInterval(progressInterval);
        error.textContent = 'éƒ¨ç½²å¤±è´¥: ' + err.message;
        error.classList.add('active');
        btn.disabled = false;
        btn.textContent = 'ä¸€é”®éƒ¨ç½²';
        status.classList.remove('active');
      }
    }
    
    function getStatusText(progress) {
      if (progress < 20) return 'æ­£åœ¨å‡†å¤‡ç¯å¢ƒ...';
      if (progress < 40) return 'æ­£åœ¨åˆ›å»ºå®ä¾‹...';
      if (progress < 60) return 'æ­£åœ¨é…ç½®çµçŠ€...';
      if (progress < 80) return 'æ­£åœ¨å¯åŠ¨æœåŠ¡...';
      return 'å³å°†å®Œæˆ...';
    }
  </script>
</body>
</html>
