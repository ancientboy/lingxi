# 灵犀云功能状态文档

> 更新时间: 2026-02-23
> 版本: MVP v1.0

---

## 一、已完成功能

### 1. 用户系统 ✅ 100%

| 功能 | 状态 | 说明 |
|------|------|------|
| 邀请码注册 | ✅ | 系统邀请码 + 用户专属邀请码 |
| 昵称+密码登录 | ✅ | JWT Token 认证 |
| 用户专属邀请码 | ✅ | 每个用户自动生成 `USER-XXXXXXXX` |
| 修改密码 | ✅ | 需验证当前密码 |
| 积分系统 | ✅ | 邀请+100，领取团队-100 |
| 首次使用引导 | ✅ | 8 种职业类型，智能推荐配置 |

**API 接口：**
```
POST /api/auth/register   # 注册
POST /api/auth/login      # 登录
GET  /api/auth/me         # 获取用户信息
POST /api/auth/update     # 更新用户信息
POST /api/auth/claim-team # 领取 AI 团队（消耗积分）
GET  /api/auth/onboarding/job-types      # 获取职业类型
GET  /api/auth/onboarding/recommendation/:jobType  # 获取推荐配置
POST /api/auth/onboarding/complete       # 完成引导
```

---

### 2. 聊天系统 ✅ 90%

| 功能 | 状态 | 说明 |
|------|------|------|
| WebSocket 实时对话 | ✅ | 流式输出 |
| HTTP 代理备用 | ✅ | WebSocket 断开时自动切换 |
| 多会话管理 | ✅ | 创建/切换/删除会话 |
| Agent 切换 | ✅ | 下拉切换不同 Agent |
| 历史消息 | ✅ | 自动加载历史 |
| 正在输入动画 | ✅ | 三点跳动动画 |
| 停止生成 | ✅ | 点击按钮中止对话 |
| 快捷回复 | ✅ | 4 个常用快捷按钮 |

**前端功能：**
- 会话列表弹窗
- 消息气泡（用户/AI）
- 欢迎界面
- 连接状态指示

**待优化：**
- [ ] 消息时间戳显示
- [ ] 消息复制按钮
- [ ] 消息重新生成
- [ ] 语音输入

---

### 3. 团队管理 ✅ 95%

| 功能 | 状态 | 说明 |
|------|------|------|
| 查看团队成员 | ✅ | 弹窗展示 |
| 添加 Agent | ✅ | 从可用列表添加 |
| 移除 Agent | ✅ | 队长不可移除 |
| Agent 信息展示 | ✅ | 头像、名称、技能 |
| 配置持久化 | ✅ | 保存到后端 |

**8 个预置 Agent：**
| ID | 名称 | 场景 |
|----|------|------|
| lingxi | 灵犀 ⚡ | 智能调度 |
| coder | 云溪 💻 | 编程开发 |
| ops | 若曦 📊 | 数据分析 |
| inventor | 紫萱 💡 | 内容创意 |
| pm | 梓萱 🎯 | 产品设计 |
| noter | 晓琳 📝 | 知识管理 |
| media | 音韵 🎨 | 多媒体创作 |
| smart | 智家 🏠 | 智能工具 |

---

### 4. 渠道集成 ✅ 80%

| 渠道 | 状态 | 说明 |
|------|------|------|
| Web 端 | ✅ | 主界面 |
| 飞书 | ✅ | 配置 AppID/Secret + Webhook |
| 企业微信 | ✅ | 配置 CorpID/AgentID/Secret |
| 微信 | ❌ | 待开发 |
| 钉钉 | ❌ | 待开发 |

**飞书配置流程：**
1. 创建飞书应用
2. 获取 App ID 和 App Secret
3. 在灵犀云填写配置
4. 复制 Webhook 到飞书开放平台
5. 配置事件订阅

**企业微信配置流程：**
1. 创建企业微信应用
2. 获取 CorpID、AgentID、Secret
3. 在灵犀云填写配置
4. 配置回调地址

---

### 5. 实例管理 ✅ 70%

| 功能 | 状态 | 说明 |
|------|------|------|
| MVP 模式 | ✅ | 共享 OpenClaw 实例（当前使用） |
| 独立实例 | ⚠️ | Docker 创建，代码已有但未启用 |
| 实例状态 | ✅ | 查询容器状态 |
| 实例重启 | ✅ | Docker restart |
| Agent 配置注入 | ✅ | 写入 agents_config.json |

**MVP 模式说明：**
- 所有用户共享一个 OpenClaw 实例（18789 端口）
- 通过 Session Key 区分用户
- Agent 配置动态更新

**独立实例模式（未启用）：**
- 每个用户独立 Docker 容器
- 独立端口（19000+）
- 独立数据目录

---

### 6. 前端界面 ✅ 75%

| 页面 | 状态 | 说明 |
|------|------|------|
| 首页 (index.html) | ✅ | 登录/注册/积分展示 |
| 聊天页 (chat.html) | ✅ | 主对话界面 |
| 团队页 (team.html) | ⚠️ | 独立页面，待整合 |

**首页功能：**
- 登录/注册切换
- 积分和邀请码展示
- 领取团队按钮（积分检查）
- 主题切换（浅/深色）

**聊天页功能：**
- 导航栏（Logo、Agent切换、用户菜单）
- 消息区域
- 输入区域（输入框 + 快捷按钮）
- 弹窗（团队、会话、配置）

---

## 二、用户痛点分析 & 实用功能建议

### 痛点 1：新用户不知道怎么用 ✅ 已解决

**~~现状问题：~~**
- ~~注册后直接进聊天页，不知道能做什么~~
- ~~不了解 8 个 Agent 各自擅长什么~~
- ~~不知道如何开始对话~~

**✅ 解决方案：首次使用引导（已实现）**
```
功能：首次使用引导
- ✅ 新用户检测（首次登录）
- ✅ 灵犀主动打招呼
- ✅ 了解用户职业和需求
- ✅ 推荐适合的 Agent 配置
- ✅ 一键应用推荐配置

流程：
1. 欢迎页 - 灵犀自我介绍
2. 职业选择 - 8 种职业类型
3. 推荐配置 - 根据职业推荐团队
4. 完成 - 显示团队预览
```

**✅ 实现优先级：P0 - 已完成**

---

### 痛点 2：积分获取渠道单一

**现状问题：**
- 只有邀请好友才能获得积分
- 没有好友可邀请的用户无法体验

**解决方案：**
```
功能：多渠道积分获取
- 每日签到：+10 积分
- 首次完善资料：+50 积分
- 首次对话：+10 积分
- 反馈建议：+20 积分
- 分享到社交媒体：+20 积分
```

**实现优先级：P1**

---

### 痛点 3：不知道 Agent 能做什么

**现状问题：**
- Agent 列表只显示名称和简介
- 用户不知道该选哪个 Agent
- 不知道如何触发特定 Agent

**解决方案：**
```
功能：Agent 能力示例
- 每个 Agent 展示 3-5 个示例对话
- 点击示例直接发送
- 显示 Agent 适合的场景标签
- 显示 Agent 已处理的任务统计
```

**实现优先级：P1**

---

### 痛点 4：对话记录不便于查阅

**现状问题：**
- 只有会话列表，没有搜索
- 无法按日期筛选
- 无法导出对话

**解决方案：**
```
功能：对话管理
- 全文搜索历史消息
- 按日期/Agent 筛选
- 导出为 Markdown/PDF
- 收藏重要消息
```

**实现优先级：P2**

---

### 痛点 5：移动端体验差

**现状问题：**
- 响应式设计不够好
- 小屏幕操作不便
- 没有移动端专属优化

**解决方案：**
```
功能：移动端优化
- 底部导航栏
- 滑动切换会话
- 语音输入
- 下拉刷新
- 长按消息操作
```

**实现优先级：P2**

---

### 痛点 6：不知道消费了多少

**现状问题：**
- 没有用量统计
- 不知道 Token 消耗
- 不知道还有多少额度

**解决方案：**
```
功能：用量统计面板
- 每日消息数统计
- Token 消耗统计
- 按使用量计费（专业版）
- 额度预警提醒
```

**实现优先级：P1**

---

## 三、未来功能规划

### Phase 1：核心体验完善（1周）

| 功能 | 优先级 | 工作量 | 用户价值 |
|------|--------|--------|----------|
| 首次使用引导 | P0 | 2天 | ⭐⭐⭐⭐⭐ |
| 积分渠道扩展 | P1 | 1天 | ⭐⭐⭐⭐ |
| Agent 示例对话 | P1 | 1天 | ⭐⭐⭐⭐ |
| 用量统计面板 | P1 | 1天 | ⭐⭐⭐ |

---

### Phase 2：商业化（2周）

| 功能 | 优先级 | 工作量 | 用户价值 |
|------|--------|--------|----------|
| 会员订阅系统 | P0 | 3天 | ⭐⭐⭐⭐⭐ |
| 支付集成 | P0 | 2天 | ⭐⭐⭐⭐⭐ |
| 会员权益差异化 | P1 | 2天 | ⭐⭐⭐⭐ |
| 邀请奖励升级 | P2 | 1天 | ⭐⭐⭐ |

**会员方案：**
```
免费版：¥0
- 3 个 Agent
- 100 消息/天
- 基础技能

专业版：¥99/月
- 8 个 Agent 全部可用
- 无限消息
- 全部技能
- 云端记忆
- 优先支持

团队版：¥299/月
- 5 人协作
- 共享空间
- 管理后台
```

---

### Phase 3：平台化（1-2月）

| 功能 | 优先级 | 工作量 | 用户价值 |
|------|--------|--------|----------|
| 技能市场 | P1 | 5天 | ⭐⭐⭐⭐⭐ |
| 自定义 Agent | P1 | 5天 | ⭐⭐⭐⭐ |
| API 开放 | P2 | 3天 | ⭐⭐⭐ |
| 多语言支持 | P2 | 2天 | ⭐⭐⭐ |
| 小程序 | P2 | 5天 | ⭐⭐⭐⭐ |

---

### Phase 4：企业版（3月+）

| 功能 | 优先级 | 工作量 | 用户价值 |
|------|--------|--------|----------|
| 私有部署 | P1 | 5天 | ⭐⭐⭐⭐⭐ |
| 企业管理后台 | P1 | 10天 | ⭐⭐⭐⭐ |
| 知识库集成 | P2 | 5天 | ⭐⭐⭐⭐ |
| 数据安全合规 | P2 | 3天 | ⭐⭐⭐⭐⭐ |

---

## 四、技术债务

### 需要尽快解决

| 问题 | 影响 | 建议 |
|------|------|------|
| JSON 文件存储 | 并发问题、数据安全 | 升级到 SQLite/PostgreSQL |
| 无错误监控 | 无法追踪线上问题 | 集成 Sentry |
| 无 API 文档 | 前后端协作困难 | 添加 Swagger |

### 可以延后处理

| 问题 | 影响 | 建议 |
|------|------|------|
| 无缓存层 | 频繁读取数据库 | 添加 Redis |
| 无日志系统 | 排查问题困难 | 添加结构化日志 |
| 前端未打包 | 加载速度慢 | Webpack/Vite 打包 |

---

## 五、数据结构

### 用户表 (users)

```json
{
  "id": "uuid",
  "nickname": "用户昵称",
  "passwordHash": "密码哈希",
  "inviteCode": "注册时使用的系统邀请码",
  "userInviteCode": "用户专属邀请码",
  "invitedBy": "邀请者ID",
  "inviteCount": 0,
  "points": 0,
  "pointsHistory": [],
  "agents": ["lingxi", "coder"],
  "instanceId": null,
  "instanceStatus": "pending",
  "createdAt": "2026-02-23T00:00:00.000Z",
  "lastLoginAt": null
}
```

### 邀请码表 (inviteCodes)

```json
{
  "code": "LINGXI-XXXXXXXX",
  "used": false,
  "usedBy": null,
  "createdAt": "2026-02-23T00:00:00.000Z"
}
```

---

## 六、API 接口清单

### 认证相关
```
POST /api/auth/register    # 注册
POST /api/auth/login       # 登录
GET  /api/auth/me          # 获取用户信息
POST /api/auth/update      # 更新用户信息
POST /api/auth/claim-team  # 领取团队
```

### 实例管理
```
POST /api/instance/assign      # 分配实例
GET  /api/instance/:id/status  # 实例状态
POST /api/instance/:id/restart # 重启实例
GET  /api/instance             # 实例列表
```

### Agent 管理
```
GET  /api/agents              # Agent 列表
POST /api/agents/user/:userId # 更新用户 Agent
GET  /api/agents/info         # Agent 详细信息
```

### 渠道配置
```
POST /api/remote-config/feishu       # 飞书配置
POST /api/remote-config/wecom        # 企业微信配置
GET  /api/remote-config/status/:userId # 配置状态
```

### 聊天代理
```
POST /api/chat/send  # HTTP 聊天代理
```

### Gateway
```
GET /api/gateway/connect-info  # 获取 WebSocket 连接信息
```

### 管理接口
```
POST /api/admin/invite-codes/generate # 生成邀请码
GET  /api/admin/invite-codes          # 邀请码列表
```

---

## 七、环境配置

### 必需环境变量

```bash
# 服务端口
PORT=3000

# JWT 密钥
JWT_SECRET=your-secret-key

# OpenClaw 配置
OPENCLAW_URL=http://localhost:18789
OPENCLAW_TOKEN=your-token
OPENCLAW_SESSION=session-id

# MVP 模式
MVP_MODE=true

# 服务器 IP
SERVER_IP=120.26.137.51

# 阿里云配置（一键部署用）
ALIYUN_ACCESS_KEY_ID=xxx
ALIYUN_ACCESS_KEY_SECRET=xxx
```

---

## 八、部署状态

| 环境 | 状态 | 地址 |
|------|------|------|
| 开发环境 | ✅ | http://localhost:3000 |
| 生产环境 | ✅ | http://120.26.137.51:3000 |
| 共享 OpenClaw | ✅ | http://120.26.137.51:18789 |
| 美国服务器 | ⚠️ | 47.253.172.221（Docker 镜像已构建） |

---

*文档维护：灵犀 ⚡*
