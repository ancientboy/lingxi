# çµçŠ€äº‘ä¸€é”®éƒ¨ç½²è®¾è®¡æ–‡æ¡£

> ç‰ˆæœ¬ï¼š1.0
> æ›´æ–°æ—¶é—´ï¼š2026-02-18
> çŠ¶æ€ï¼šè§„åˆ’ä¸­

---

## 1. åŠŸèƒ½æ¦‚è¿°

### 1.1 ç›®æ ‡

ç”¨æˆ·ç‚¹å‡»ã€Œé¢†å– AI å›¢é˜Ÿã€åï¼Œç³»ç»Ÿè‡ªåŠ¨ï¼š
1. åˆ›å»º/åˆ†é…æœåŠ¡å™¨
2. éƒ¨ç½² OpenClaw Gateway
3. é…ç½® Agent å›¢é˜Ÿ
4. å®‰è£… Skills
5. è¿”å›è®¿é—®åœ°å€

### 1.2 éƒ¨ç½²æ¨¡å¼

| æ¨¡å¼ | è¯´æ˜ | å½“å‰çŠ¶æ€ |
|------|------|---------|
| **MVP æ¨¡å¼** | å…±äº« OpenClaw å®ä¾‹ï¼Œsession éš”ç¦» | âœ… å·²å®ç° |
| **å…±äº«äº‘æ¨¡å¼** | å¤šç”¨æˆ·å…±äº«äº‘æœåŠ¡å™¨ï¼ŒDocker éš”ç¦» | â³ å¾…å¼€å‘ |
| **ç‹¬ç«‹äº‘æ¨¡å¼** | æ¯ç”¨æˆ·ç‹¬ç«‹äº‘æœåŠ¡å™¨ | â³ å¾…å¼€å‘ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 MVP æ¨¡å¼ï¼ˆå½“å‰ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æœåŠ¡å™¨ (120.26.137.51)                  â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           OpenClaw Gateway (å…±äº«å®ä¾‹)                â”‚   â”‚
â”‚  â”‚                    ç«¯å£: 18789                       â”‚   â”‚
â”‚  â”‚                                                     â”‚   â”‚
â”‚  â”‚   ç”¨æˆ·A â†’ session: user_aaa:main                    â”‚   â”‚
â”‚  â”‚   ç”¨æˆ·B â†’ session: user_bbb:main                    â”‚   â”‚
â”‚  â”‚   ç”¨æˆ·C â†’ session: user_ccc:main                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â†‘                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              çµçŠ€äº‘åç«¯ (Node.js)                    â”‚   â”‚
â”‚  â”‚                    ç«¯å£: 3000                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹ï¼š**
- æˆæœ¬ä½ï¼ˆ1 å°æœåŠ¡å™¨ï¼‰
- éƒ¨ç½²ç®€å•
- é€‚åˆæµ‹è¯•/MVP

**ç¼ºç‚¹ï¼š**
- èµ„æºå…±äº«ï¼Œæ€§èƒ½å—é™
- ç”¨æˆ·é—´æœ‰ä¸€å®šå½±å“
- ä¸é€‚åˆå¤§è§„æ¨¡

---

### 2.2 ç‹¬ç«‹äº‘æ¨¡å¼ï¼ˆç›®æ ‡ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      çµçŠ€äº‘æ§åˆ¶ä¸­å¿ƒ                          â”‚
â”‚                                                             â”‚
â”‚  â€¢ ç”¨æˆ·ç®¡ç†                                                 â”‚
â”‚  â€¢ æœåŠ¡å™¨ç®¡ç†                                               â”‚
â”‚  â€¢ éƒ¨ç½²è°ƒåº¦                                                 â”‚
â”‚  â€¢ ç›‘æ§å‘Šè­¦                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·A æœåŠ¡å™¨  â”‚   â”‚  ç”¨æˆ·B æœåŠ¡å™¨  â”‚   â”‚  ç”¨æˆ·C æœåŠ¡å™¨  â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ OpenClaw  â”‚ â”‚   â”‚ â”‚ OpenClaw  â”‚ â”‚   â”‚ â”‚ OpenClaw  â”‚ â”‚
â”‚ â”‚ Gateway   â”‚ â”‚   â”‚ â”‚ Gateway   â”‚ â”‚   â”‚ â”‚ Gateway   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Agenté…ç½® â”‚ â”‚   â”‚ â”‚ Agenté…ç½® â”‚ â”‚   â”‚ â”‚ Agenté…ç½® â”‚ â”‚
â”‚ â”‚ Skills    â”‚ â”‚   â”‚ â”‚ Skills    â”‚ â”‚   â”‚ â”‚ Skills    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹ï¼š**
- å®Œå…¨éš”ç¦»
- æ€§èƒ½ç‹¬ç«‹
- å¯å®šåˆ¶åŒ–
- é€‚åˆå•†ä¸šåŒ–

**ç¼ºç‚¹ï¼š**
- æˆæœ¬é«˜
- è¿ç»´å¤æ‚

---

## 3. æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 äº‘æœåŠ¡å™¨ API

#### é˜¿é‡Œäº‘ ECS API

é˜¿é‡Œäº‘æä¾›å®Œæ•´çš„ API æ”¯æŒè‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†æœåŠ¡å™¨ï¼š

**ä¸»è¦ APIï¼š**
| API | åŠŸèƒ½ | æ–‡æ¡£ |
|-----|------|------|
| `CreateInstance` | åˆ›å»º ECS å®ä¾‹ | [é“¾æ¥](https://help.aliyun.com/document_detail/25499.html) |
| `StartInstance` | å¯åŠ¨å®ä¾‹ | [é“¾æ¥](https://help.aliyun.com/document_detail/25502.html) |
| `AllocatePublicIpAddress` | åˆ†é…å…¬ç½‘ IP | [é“¾æ¥](https://help.aliyun.com/document_detail/25504.html) |
| `DescribeInstances` | æŸ¥è¯¢å®ä¾‹åˆ—è¡¨ | [é“¾æ¥](https://help.aliyun.com/document_detail/25506.html) |

**SDK æ”¯æŒï¼š**
```javascript
// Node.js SDK
const Ecs20140526 = require('@alicloud/ecs20140526');

// åˆ›å»ºå®ä¾‹
const response = await client.createInstance({
  regionId: 'cn-shanghai',
  instanceType: 'ecs.t6-c1m2.large',
  imageId: 'ubuntu_22_04_x64_20G_alibase_20230208.vhd',
  securityGroupId: 'sg-xxx',
  vSwitchId: 'vsw-xxx',
  instanceName: `lingxi-user-${userId}`,
  password: randomPassword,
  internetMaxBandwidthOut: 10,  // 10Mbps
});
```

**æµç¨‹ï¼š**
```
1. è°ƒç”¨ CreateInstance â†’ è·å– instanceId
2. è°ƒç”¨ StartInstance â†’ å¯åŠ¨å®ä¾‹
3. è°ƒç”¨ AllocatePublicIpAddress â†’ è·å–å…¬ç½‘ IP
4. ç­‰å¾…å®ä¾‹å°±ç»ª (çº¦ 1-3 åˆ†é’Ÿ)
5. SSH è¿æ¥å¹¶éƒ¨ç½²
```

---

#### å…¶ä»–äº‘æœåŠ¡å•†

| äº‘æœåŠ¡å•† | API æ”¯æŒ | SDK |
|---------|---------|-----|
| è…¾è®¯äº‘ CVM | âœ… å®Œæ•´ | Node.js/Python |
| AWS EC2 | âœ… å®Œæ•´ | Node.js/Python |
| åä¸ºäº‘ ECS | âœ… å®Œæ•´ | Node.js/Python |
| Azure VM | âœ… å®Œæ•´ | Node.js/Python |

---

### 3.2 è¿œç¨‹éƒ¨ç½²æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éƒ¨ç½²æ§åˆ¶ä¸­å¿ƒ                              â”‚
â”‚                   (å½“å‰æœåŠ¡å™¨)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: åˆ›å»ºæœåŠ¡å™¨                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ è°ƒç”¨äº‘ API åˆ›å»º ECS                                       â”‚
â”‚  â€¢ ç­‰å¾…å®ä¾‹å°±ç»ª                                              â”‚
â”‚  â€¢ è·å–å…¬ç½‘ IP                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: SSH è¿æ¥                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ ä½¿ç”¨ SSH2 åº“è¿æ¥                                          â”‚
â”‚  â€¢ æˆ–é€šè¿‡ SSH å¯†é’¥è®¤è¯                                        â”‚
â”‚                                                              â”‚
â”‚  const { Client } = require('ssh2');                        â”‚
â”‚  const conn = new Client();                                 â”‚
â”‚  conn.connect({ host, port: 22, username, password });      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: å®‰è£…ä¾èµ–                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ å®‰è£… Docker                                              â”‚
â”‚  â€¢ é…ç½®é˜²ç«å¢™/å®‰å…¨ç»„                                          â”‚
â”‚  â€¢ å®‰è£… Node.js (å¯é€‰)                                       â”‚
â”‚                                                              â”‚
â”‚  conn.exec('curl -fsSL https://get.docker.com | sh');       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: éƒ¨ç½² OpenClaw                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ æ‹‰å– Docker é•œåƒ                                          â”‚
â”‚  â€¢ åˆ›å»ºé…ç½®æ–‡ä»¶                                              â”‚
â”‚  â€¢ å¯åŠ¨å®¹å™¨                                                  â”‚
â”‚                                                              â”‚
â”‚  docker run -d \                                            â”‚
â”‚    --name openclaw \                                        â”‚
â”‚    -p 18789:18789 \                                         â”‚
â”‚    -v /data/openclaw:/data \                                â”‚
â”‚    openclaw/openclaw:latest                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: é…ç½® Agent å›¢é˜Ÿ                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ å†™å…¥ç”¨æˆ·é€‰æ‹©çš„ Agents                                     â”‚
â”‚  â€¢ é…ç½® SOUL.md                                             â”‚
â”‚  â€¢ å®‰è£… Skills                                              â”‚
â”‚                                                              â”‚
â”‚  conn.exec(`cat > /data/openclaw/SOUL.md << 'EOF'           â”‚
â”‚    ${soulContent}                                           â”‚
â”‚  EOF`);                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: è¿”å›è®¿é—®åœ°å€                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ è¿”å› Gateway URL                                         â”‚
â”‚  â€¢ è¿”å› Token                                               â”‚
â”‚  â€¢ ä¿å­˜åˆ°æ•°æ®åº“                                              â”‚
â”‚                                                              â”‚
â”‚  {                                                          â”‚
â”‚    success: true,                                           â”‚
â”‚    url: "http://47.xx.xx.xx:18789",                         â”‚
â”‚    token: "xxx",                                            â”‚
â”‚    expiresAt: "2026-03-18"                                  â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3.3 ç«¯å£ä¸ç½‘ç»œé…ç½®

**å®‰å…¨ç»„è§„åˆ™ï¼ˆé˜¿é‡Œäº‘ï¼‰ï¼š**
```
å…¥æ–¹å‘è§„åˆ™ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç«¯å£èŒƒå›´  â”‚ åè®®     â”‚ æˆæƒå¯¹è±¡   â”‚ è¯´æ˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 22       â”‚ TCP      â”‚ æ§åˆ¶ä¸­å¿ƒIP â”‚ SSH ç®¡ç†        â”‚
â”‚ 3000     â”‚ TCP      â”‚ 0.0.0.0/0 â”‚ çµçŠ€äº‘åç«¯      â”‚
â”‚ 18789    â”‚ TCP      â”‚ 0.0.0.0/0 â”‚ OpenClaw Gatewayâ”‚
â”‚ 80/443   â”‚ TCP      â”‚ 0.0.0.0/0 â”‚ HTTP/HTTPS     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é€šè¿‡ API é…ç½®å®‰å…¨ç»„ï¼š**
```javascript
// é˜¿é‡Œäº‘ SDK
await client.authorizeSecurityGroup({
  securityGroupId: 'sg-xxx',
  ipProtocol: 'tcp',
  portRange: '18789/18789',
  sourceCidrIp: '0.0.0.0/0',
  description: 'OpenClaw Gateway'
});
```

---

### 3.4 ä»£ç ç¤ºä¾‹

#### éƒ¨ç½²æ§åˆ¶å™¨ (Node.js)

```javascript
// controllers/deploy.js

import Ecs20140526, { CreateInstanceRequest } from '@alicloud/ecs20140526';
import { Client as SSHClient } from 'ssh2';

class DeployController {
  
  /**
   * ä¸€é”®éƒ¨ç½²
   */
  async deploy(userId, agentConfig) {
    // 1. åˆ›å»ºæœåŠ¡å™¨
    const server = await this.createServer(userId);
    
    // 2. ç­‰å¾…å°±ç»ª
    await this.waitForReady(server.ip);
    
    // 3. SSH éƒ¨ç½²
    await this.sshDeploy(server, agentConfig);
    
    // 4. è¿”å›ç»“æœ
    return {
      url: `http://${server.ip}:18789`,
      token: server.token,
      expiresAt: server.expiresAt
    };
  }
  
  /**
   * åˆ›å»º ECS å®ä¾‹
   */
  async createServer(userId) {
    const client = new Ecs20140526(this.aliyunConfig);
    
    const request = new CreateInstanceRequest({
      regionId: 'cn-shanghai',
      instanceType: 'ecs.t6-c1m2.large',  // 2æ ¸4G
      imageId: 'ubuntu_22_04_x64_20G_alibase',
      securityGroupId: process.env.ALIYUN_SECURITY_GROUP,
      vSwitchId: process.env.ALIYUN_VSWITCH,
      instanceName: `lingxi-${userId}`,
      password: this.generatePassword(),
      internetMaxBandwidthOut: 10,
      period: 1,  // æŒ‰æœˆä»˜è´¹
    });
    
    const response = await client.CreateInstance(request);
    const instanceId = response.body.instanceId;
    
    // å¯åŠ¨å¹¶è·å– IP
    await client.StartInstance({ instanceId });
    await client.AllocatePublicIpAddress({ instanceId });
    
    // æŸ¥è¯¢ IP
    const detail = await client.DescribeInstances({
      instanceIds: JSON.stringify([instanceId])
    });
    
    return {
      instanceId,
      ip: detail.body.instances.instance[0].publicIpAddress.ipAddress[0],
      password: request.password
    };
  }
  
  /**
   * SSH è¿œç¨‹éƒ¨ç½²
   */
  async sshDeploy(server, agentConfig) {
    return new Promise((resolve, reject) => {
      const conn = new SSHClient();
      
      conn.on('ready', async () => {
        console.log(`ğŸ“¦ SSH å·²è¿æ¥: ${server.ip}`);
        
        // æ‰§è¡Œéƒ¨ç½²è„šæœ¬
        const commands = [
          // å®‰è£… Docker
          'curl -fsSL https://get.docker.com | sh',
          'systemctl start docker',
          
          // åˆ›å»ºæ•°æ®ç›®å½•
          'mkdir -p /data/openclaw',
          
          // å¯åŠ¨ OpenClaw
          `docker run -d \
            --name openclaw \
            --restart unless-stopped \
            -p 18789:18789 \
            -v /data/openclaw:/root/.openclaw \
            openclaw/openclaw:latest`,
          
          // ç­‰å¾…å¯åŠ¨
          'sleep 10',
          
          // é…ç½® Gateway Token
          `docker exec openclaw openclaw gateway --token ${server.token}`,
        ];
        
        for (const cmd of commands) {
          await this.execCommand(conn, cmd);
        }
        
        conn.end();
        resolve();
      });
      
      conn.on('error', reject);
      
      conn.connect({
        host: server.ip,
        port: 22,
        username: 'root',
        password: server.password,
        readyTimeout: 30000
      });
    });
  }
  
  /**
   * æ‰§è¡Œ SSH å‘½ä»¤
   */
  execCommand(conn, cmd) {
    return new Promise((resolve, reject) => {
      conn.exec(cmd, (err, stream) => {
        if (err) return reject(err);
        
        stream.on('close', () => resolve());
        stream.on('data', (data) => {
          console.log(`[SSH] ${data.toString()}`);
        });
      });
    });
  }
  
  /**
   * ç­‰å¾…æœåŠ¡å™¨å°±ç»ª
   */
  async waitForReady(ip, timeout = 120000) {
    const startTime = Date.now();
    
    while (Date.now() - startTime < timeout) {
      try {
        // å°è¯• SSH è¿æ¥
        await new Promise((resolve, reject) => {
          const conn = new SSHClient();
          conn.on('ready', () => {
            conn.end();
            resolve();
          });
          conn.on('error', reject);
          conn.connect({
            host: ip,
            port: 22,
            username: 'root',
            password: 'test',  // å®é™…ä½¿ç”¨æ­£ç¡®å¯†ç 
            readyTimeout: 5000
          });
        });
        return true;
      } catch {
        await new Promise(r => setTimeout(r, 5000));
      }
    }
    
    throw new Error('Server not ready in time');
  }
  
  /**
   * ç”Ÿæˆéšæœºå¯†ç 
   */
  generatePassword() {
    return require('crypto').randomBytes(16).toString('base64');
  }
}

export default DeployController;
```

---

## 4. API è®¾è®¡

### 4.1 éƒ¨ç½² API

```yaml
POST /api/deploy/create
  æè¿°: åˆ›å»ºå¹¶éƒ¨ç½²æ–°å®ä¾‹
  è¯·æ±‚:
    {
      "userId": "xxx",
      "agents": ["lingxi", "coder", "ops"],
      "plan": "basic" | "standard" | "premium",  # å¥—é¤
      "region": "cn-shanghai" | "cn-hangzhou"    # åœ°åŒº
    }
  å“åº”:
    {
      "success": true,
      "deployment": {
        "id": "dep_xxx",
        "status": "creating" | "deploying" | "ready",
        "url": "http://47.xx.xx.xx:18789",
        "estimatedTime": 180  # ç§’
      }
    }

GET /api/deploy/:id/status
  æè¿°: æŸ¥è¯¢éƒ¨ç½²çŠ¶æ€
  å“åº”:
    {
      "id": "dep_xxx",
      "status": "ready",
      "url": "http://47.xx.xx.xx:18789",
      "progress": 100,
      "logs": ["åˆ›å»ºæœåŠ¡å™¨...", "å®‰è£… Docker...", "éƒ¨ç½²å®Œæˆ"]
    }

DELETE /api/deploy/:id
  æè¿°: é”€æ¯å®ä¾‹
  å“åº”:
    { "success": true }
```

---

## 5. æˆæœ¬ä¼°ç®—

### 5.1 äº‘æœåŠ¡å™¨è´¹ç”¨

| å¥—é¤ | é…ç½® | é˜¿é‡Œäº‘/æœˆ | é€‚åˆ |
|------|------|----------|------|
| Basic | 1æ ¸2G | ~50å…ƒ | è½»åº¦ä½¿ç”¨ |
| Standard | 2æ ¸4G | ~100å…ƒ | æ­£å¸¸ä½¿ç”¨ |
| Premium | 4æ ¸8G | ~200å…ƒ | é‡åº¦ä½¿ç”¨ |

### 5.2 å…¶ä»–è´¹ç”¨

| é¡¹ç›® | è´¹ç”¨ |
|------|------|
| å…¬ç½‘å¸¦å®½ | ~20å…ƒ/Mbps/æœˆ |
| äº‘ç›˜ | ~1å…ƒ/GB/æœˆ |
| API è°ƒç”¨ | å…è´¹é¢åº¦å†… |

---

## 6. å¾…å¼€å‘ä»»åŠ¡

### Phase 1: åŸºç¡€è®¾æ–½
- [ ] é˜¿é‡Œäº‘ SDK é›†æˆ
- [ ] æœåŠ¡å™¨åˆ›å»º/é”€æ¯ API
- [ ] SSH è¿œç¨‹éƒ¨ç½²æ¨¡å—
- [ ] å®‰å…¨ç»„è‡ªåŠ¨é…ç½®

### Phase 2: éƒ¨ç½²è‡ªåŠ¨åŒ–
- [ ] ä¸€é”®éƒ¨ç½²è„šæœ¬
- [ ] éƒ¨ç½²è¿›åº¦è¿½è¸ª
- [ ] éƒ¨ç½²æ—¥å¿—è®°å½•
- [ ] å¤±è´¥é‡è¯•æœºåˆ¶

### Phase 3: è¿ç»´ç®¡ç†
- [ ] å®ä¾‹ç›‘æ§
- [ ] è‡ªåŠ¨ç»­è´¹
- [ ] èµ„æºå‘Šè­¦
- [ ] æˆæœ¬ç»Ÿè®¡

### Phase 4: ç”¨æˆ·ç•Œé¢
- [ ] éƒ¨ç½²å‘å¯¼é¡µé¢
- [ ] å¥—é¤é€‰æ‹©
- [ ] åœ°åŒºé€‰æ‹©
- [ ] éƒ¨ç½²è¿›åº¦å±•ç¤º

---

## 7. å‚è€ƒèµ„æº

- [é˜¿é‡Œäº‘ ECS API æ–‡æ¡£](https://help.aliyun.com/product/25367.html)
- [é˜¿é‡Œäº‘ Node.js SDK](https://github.com/aliyun/openapi-core-nodejs-sdk)
- [SSH2 Node.js åº“](https://github.com/mscdex/ssh2)
- [OpenClaw éƒ¨ç½²æ–‡æ¡£](https://docs.openclaw.ai)

---

*æœ¬æ–‡æ¡£æŒç»­æ›´æ–°ä¸­...*
